/*!
 * Facade.js v0.3.0beta
 * https://github.com/neogeek/facade.js
 * 
 * Copyright (c) 2014 Scott Doxey
 * Dual-licensed under both MIT and BSD licenses.
 */

!function(){"use strict";function a(a){return"[object Array]"===Object.prototype.toString.call(a)?!0:!1}function b(a){return"[object Function]"===Object.prototype.toString.call(a)?!0:!1}function c(a,b,d){if(!(this instanceof c))return new c(a,b,d);a&&"object"===String(typeof a)&&1===a.nodeType?this.canvas=a:(this.canvas=document.createElement("canvas"),"string"===String(typeof a)&&this.canvas.setAttribute("id",a)),b&&d&&(this.canvas.setAttribute("width",parseInt(b,10)),this.canvas.setAttribute("height",parseInt(d,10)));try{this.context=this.canvas.getContext("2d")}catch(e){throw new Error("Canvas passed to Facade.js was not a valid canvas element.")}this.dt=null,this.fps=null,this.ftime=null,this._callback=null,this._requestAnimation=null}var d,e,f=["fillStyle","font","globalAlpha","globalCompositeOperation","lineCap","lineJoin","lineWidth","miterLimit","shadowBlur","shadowColor","shadowOffsetX","shadowOffsetY","strokeStyle","textAlign","textBaseline"],g=Math.PI/180;["webkit","moz"].forEach(function(a){d=d||window.requestAnimationFrame||window[a+"RequestAnimationFrame"]||null,e=e||window.cancelAnimationFrame||window[a+"CancelAnimationFrame"]||null}),c.prototype.addToStage=function(a){if(!(a instanceof c.Entity))throw new Error("Parameter passed to Facade.addToStage is not a valid Facade.js entity object");return a.draw(this),this},c.prototype.clear=function(){return this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this},c.prototype.draw=function(a){if("function"!==String(typeof a))throw new Error("Parameter passed to Facade.draw is not a valid function");return this._callback=a,this.start(),this},c.prototype.exportBase64=function(a,b){return a||(a="image/png"),"number"===String(typeof b)?b/=100:b=1,this.canvas.toDataURL(a,b)},c.prototype.height=function(a){return a&&this.canvas.setAttribute("height",parseInt(a,10)),this.canvas.height},c.prototype.renderWithContext=function(c,d){var e;this.context.save();for(e in c)c.hasOwnProperty(e)&&(a(c[e])&&b(this.context[e])?this.context[e].apply(this.context,c[e]):-1!==f.indexOf(e)&&(this.context[e]=c[e]));d&&d.call(null,this),this.context.restore()},c.prototype.start=function(){return this._requestAnimation=d(this._animate.bind(this)),this},c.prototype.stop=function(){return this.dt=null,this.fps=null,this.ftime=null,e(this._requestAnimation),this._requestAnimation=null,this},c.prototype.width=function(a){return a&&this.canvas.setAttribute("width",parseInt(a,10)),this.canvas.width},c.prototype._animate=function(a){return"function"===String(typeof this._callback)?(this.ftime&&(this.dt=a-this.ftime,this.fps=(1e3/this.dt).toFixed(2)),this._requestAnimation=d(this._animate.bind(this)),this.ftime=a,this.context.save(),this._callback(),this.context.restore()):this.stop(),this},c.Entity=function(){return void 0},c.Entity.prototype._defaultOptions=function(a){var b,c;b={x:0,y:0,anchor:"top/left"};for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},c.Entity.prototype._defaultMetrics=function(a){var b,c={x:null,y:null,width:null,height:null};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c},c.Entity.prototype._getAnchorPoint=function(a,b){var c=[0,0],d=this._getStrokeWidthOffset(a);return c[0]=a.anchor.match(/center$/)?-b.width/2+d:a.anchor.match(/right$/)?-b.width+d:d,c[1]=a.anchor.match(/^center/)?-b.height/2+d:a.anchor.match(/^bottom/)?-b.height+d:d,c},c.Entity.prototype._getStrokeWidthOffset=function(a){var b=a.lineWidth/2;return b},c.Entity.prototype.getOption=function(a){return this._options.hasOwnProperty(a)?this._options[a]:void 0},c.Entity.prototype.getAllOptions=function(){var a,b={};for(a in this._options)this._options.hasOwnProperty(a)&&(b[a]=this._options[a]);return b},c.Entity.prototype.setOption=function(a,b,c){var d=this.getAllOptions();if(d.hasOwnProperty(a)){if(String(typeof d[a])!==String(typeof b))throw new Error("The value for "+a+" ("+b+") was a "+String(typeof b)+" not a "+typeof this._options[a]);return c!==!0&&(this._options[a]=b),b}return void 0},c.Entity.prototype.setOptions=function(a,b){var c,d=this.getAllOptions();for(c in a)a.hasOwnProperty(c)&&d.hasOwnProperty(c)&&(d[c]=this.setOption(c,a[c],b));return d},c.Entity.prototype.getMetric=function(a){return this._metrics.hasOwnProperty(a)?this._metrics[a]:void 0},c.Entity.prototype.getAllMetrics=function(){var a,b={};for(a in this._metrics)this._metrics.hasOwnProperty(a)&&(b[a]=this._metrics[a]);return b},c.Entity.prototype.calculateRotatedBounds=function(a,b){var c=b%90*g,d=a.height*Math.sin(c)+a.width*Math.cos(c),e=a.height*Math.cos(c)+a.width*Math.sin(c);return a.x=a.x-(d-a.width)/2,a.y=a.y-(e-a.height)/2,a.width=d,a.height=e,a},c.Entity.prototype.draw=function(a){var c=this.getAllOptions();b(this._configOptions)&&(c=this._configOptions(c)),b(this._draw)&&a.renderWithContext(c,this._draw.bind(this,a))},c.Polygon=function(a){return this instanceof c.Polygon?(this._options=this._defaultOptions(),this._metrics=this._defaultMetrics(),void this.setOptions(a)):new c.Polygon(a)},c.Polygon.prototype=Object.create(c.Entity.prototype),c.Polygon.constructor=c.Entity,c.Polygon.prototype._defaultOptions=function(a){var b,d;b=c.Entity.prototype._defaultOptions({opacity:100,shadowBlur:0,shadowColor:"#000",shadowOffsetX:0,shadowOffsetY:0,points:[],fillStyle:"",strokeStyle:"",lineWidth:1,lineCap:"default",lineJoin:"miter",closePath:!0,rotate:0});for(d in a)a.hasOwnProperty(d)&&(b[d]=a[d]);return b},c.Polygon.prototype._draw=function(a){var c,d=a.context,e=this.getAllOptions(),f=this._setMetrics(),g=this._getAnchorPoint(e,f);if(b(this._configOptions)&&(e=this._configOptions(e)),d.translate.apply(d,g),e.rotate&&(d.translate(e.width/2,e.height/2),d.rotate(e.rotate*Math.PI/180),d.translate(-e.width/2,-e.height/2)),e.points.length){d.beginPath();for(c in e.points)e.points.hasOwnProperty(c)&&(6===e.points[c].length?d.bezierCurveTo.apply(d,e.points[c]):5===e.points[c].length?d.arc.apply(d,e.points[c]):d.lineTo.apply(d,e.points[c]));e.closePath?d.closePath():d.moveTo.apply(d,e.points[c]),e.fillStyle&&d.fill(),e.lineWidth>0&&d.stroke()}},c.Polygon.prototype._configOptions=function(a){return a.translate=[a.x,a.y],a.globalAlpha=a.opacity/100,a},c.Polygon.prototype._setMetrics=function(){var a,d,e=this.getAllMetrics(),f=this.getAllOptions(),g={top:null,right:null,bottom:null,left:null},h=this._getStrokeWidthOffset(f);b(this._configOptions)&&(f=this._configOptions(f));for(a in f.points)f.points.hasOwnProperty(a)&&(2===f.points[a].length?a={x:f.points[a][0],y:f.points[a][1]}:5===f.points[a].length&&(e.width=2*f.points[a][2],e.height=2*f.points[a][2],a={x:f.points[a][0]-f.points[a][2],y:f.points[a][1]-f.points[a][2]}),(a.x<g.left||null===g.left)&&(g.left=a.x),(a.y<g.top||null===g.top)&&(g.top=a.y),(a.x>g.right||null===g.right)&&(g.right=a.x),(a.y>g.bottom||null===g.bottom)&&(g.bottom=a.y));return e.x=f.x+g.left,e.y=f.y+g.top,null===e.width&&null===e.height&&(e.width=g.right-g.left,e.height=g.bottom-g.top),e.width=e.width+2*h,e.height=e.height+2*h,d=this._getAnchorPoint(f,e),e.x=e.x+d[0]-h,e.y=e.y+d[1]-h,this instanceof c.Circle&&(e.x=e.x+f.radius,e.y=e.y+f.radius),e},c.Circle=function(a){return this instanceof c.Circle?(this._options=this._defaultOptions({radius:0,begin:0,end:360}),this._metrics=this._defaultMetrics(),void this.setOptions(a)):new c.Circle(a)},c.Circle.prototype=Object.create(c.Polygon.prototype),c.Circle.constructor=c.Polygon,c.Circle.prototype._configOptions=function(a){return a.translate=[a.x+a.radius,a.y+a.radius],a.globalAlpha=a.opacity/100,a.points=[[0,0,a.radius,a.begin*g,a.end*g]],a},c.Line=function(a){return this instanceof c.Line?(this._options=this._defaultOptions({x1:0,y1:0,x2:0,y2:0}),this._metrics=this._defaultMetrics(),void this.setOptions(a)):new c.Line(a)},c.Line.prototype=Object.create(c.Polygon.prototype),c.Line.constructor=c.Polygon,c.Line.prototype._configOptions=function(a){return a.translate=[a.x,a.y],a.globalAlpha=a.opacity/100,a.closePath=!1,a.points=[[a.x1,a.y1],[a.x2,a.y2]],a},c.Rect=function(a){return this instanceof c.Rect?(this._options=this._defaultOptions({width:0,height:0}),this._metrics=this._defaultMetrics(),void this.setOptions(a)):new c.Rect(a)},c.Rect.prototype=Object.create(c.Polygon.prototype),c.Rect.constructor=c.Polygon,c.Rect.prototype._configOptions=function(a){return a.translate=[a.x,a.y],a.globalAlpha=a.opacity/100,a.points=[[0,0],[a.width,0],[a.width,a.height],[0,a.height]],a},c.Group=function(a){return this instanceof c.Group?(this._options=this._defaultOptions(),this._metrics=this._defaultMetrics(),this.setOptions(a),void(this._objects=[])):new c.Group(a)},c.Group.prototype=Object.create(c.Entity.prototype),c.Group.constructor=c.Entity,c.Group.prototype._draw=function(a){var b;for(b in this._objects)this._objects.hasOwnProperty(b)&&a.addToStage(this._objects[b])},c.Group.prototype._configOptions=function(a){return a.translate=[a.x,a.y],a},c.Group.prototype.addToGroup=function(a){a instanceof c.Entity&&-1===this._objects.indexOf(a)&&this._objects.push(a)},c.Group.prototype.removeFromGroup=function(a){a instanceof c.Entity&&-1!==this._objects.indexOf(a)&&this._objects.splice(this._objects.indexOf(a),1)},c.Group.prototype._setMetrics=function(){var a,b,c=this.getAllMetrics(),d=this.getAllOptions(),e={top:null,right:null,bottom:null,left:null};for(a in this._objects)this._objects.hasOwnProperty(a)&&(b=this._objects[a]._setMetrics(),(b.x<e.left||null===e.left)&&(e.left=b.x),(b.y<e.top||null===e.top)&&(e.top=b.y),(b.x+b.width>e.right||null===e.right)&&(e.right=b.x+b.width),(b.y+b.height>e.bottom||null===e.bottom)&&(e.bottom=b.y+b.height));return c.x=d.x+e.left,c.y=d.y+e.top,c.width=e.right-e.left,c.height=e.bottom-e.top,c},"function"===String(typeof window.define)&&window.define.hasOwnProperty("amd")?window.define([],function(){return c}):window.Facade=c}();
//# sourceMappingURL=facade.min.map