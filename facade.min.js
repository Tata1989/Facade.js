/*!
 * Facade.js (facadejs.com)
 * Copyright (c) 2013 Scott Doxey
 * Dual-licensed under both MIT and BSD licenses.
 */
!function(){"use strict";["webkit","moz"].forEach(function(t){window.requestAnimationFrame=window.requestAnimationFrame||window[t+"RequestAnimationFrame"]||null;window.cancelAnimationFrame=window.cancelAnimationFrame||window[t+"CancelAnimationFrame"]||null});var t=function(i,e,s){if(i&&typeof i=="object"&&i.nodeType==1){this.canvas=i}else{this.canvas=document.createElement("canvas");if(typeof i=="string"){this.canvas.setAttribute("id",i)}if(e&&s){this.canvas.setAttribute("width",parseInt(e,10));this.canvas.setAttribute("height",parseInt(s,10))}}try{this.context=this.canvas.getContext("2d")}catch(o){throw new Error("Object passed to Facade.js is not a valid canvas element.")}this.dt=0;this.fps=0;this.ftime=null;this.callback=null;this.requestAnimation=null;this.addToStage=function(i,e){e=t.prototype.setOptions(i.options,e);this.context.save();t.prototype.setAnchorPoint.call(this,i,e);if(!(i instanceof t.Image)){if(i.metrics.x+i.metrics.width<0||i.metrics.y+i.metrics.height<0||i.metrics.x>this.canvas.width||i.metrics.y>this.canvas.height){this.context.restore();return this}}this.context.scale(e.scale,e.scale);t.prototype.setRotate.call(this,i,e);if(e.fillStyle){this.context.fillStyle=e.fillStyle}this.context.globalAlpha=e.opacity/100;if(e.lineCap){this.context.lineCap=e.lineCap}if(e.lineWidth){this.context.strokeStyle=e.strokeStyle;this.context.lineWidth=e.lineWidth}if(e.shadowBlur){this.context.shadowBlur=e.shadowBlur;this.context.shadowColor=e.shadowColor;this.context.shadowOffsetX=e.shadowOffsetX;this.context.shadowOffsetY=e.shadowOffsetY}if(i instanceof t.Circle){this.context.beginPath();this.context.arc(0,0,e.radius,e.start*Math.PI/180,e.end*Math.PI/180,e.counterclockwise);if(e.fillStyle){this.context.fill()}if(e.strokePosition=="inset"){this.context.closePath();this.context.beginPath();this.context.arc(0,0,e.radius-e.lineWidth/2,e.start*Math.PI/180,e.end*Math.PI/180,e.counterclockwise)}else if(e.strokePosition=="outset"){this.context.closePath();this.context.beginPath();this.context.arc(0,0,e.radius+e.lineWidth/2,e.start*Math.PI/180,e.end*Math.PI/180,e.counterclockwise)}if(e.lineWidth){this.context.stroke()}this.context.closePath()}else if(i instanceof t.Image&&i.isLoaded){var s=0;if(e.frames.length){s=e.frames[i.frame]}for(var o=0;o<e.tileX;o++){for(var h=0;h<e.tileY;h++){if(i.metrics.x+e.width*(o+1)<0||i.metrics.y+e.height*(h+1)<0||i.metrics.x+e.width*o>this.canvas.width||i.metrics.y+e.height*h>this.canvas.height){break}i.metrics.width=e.width*(o+1);i.metrics.height=e.height*(h+1);this.context.drawImage(i.elem,e.width*s+e.offsetX,e.offsetY,e.width,e.height,e.width*o,e.height*h,e.width,e.height)}}if(e.frames.length){if(!i.ftime){i.ftime=this.ftime}if(this.ftime-i.ftime>=e.speed){i.ftime=this.ftime;i.frame++}if(i.frame>=e.frames.length){if(e.loop){i.frame=0}else{i.frame=e.frames.length-1}}}}else if(i instanceof t.Line){this.context.beginPath();this.context.moveTo(0,0);this.context.lineTo(e.endX-e.startX,e.endY-e.startY);this.context.stroke();this.context.closePath()}else if(i instanceof t.Rect){this.context.beginPath();if(e.borderRadius){var n=Math.min(e.borderRadius,e.height/2,e.width/2);this.context.moveTo(n,0);this.context.arc(e.width-n,n,n,Math.PI*1.5,0);this.context.arc(e.width-n,e.height-n,n,0,Math.PI*.5);this.context.arc(n,e.height-n,n,Math.PI*.5,Math.PI);this.context.arc(n,n,n,Math.PI,Math.PI*1.5);if(e.fillStyle){this.context.fill()}if(e.lineWidth){this.context.stroke()}}else{if(e.fillStyle){this.context.fillRect(0,0,e.width,e.height);this.context.fill()}if(e.lineWidth){if(e.strokePosition=="inset"){this.context.closePath();this.context.beginPath();this.context.strokeRect(e.lineWidth/2,e.lineWidth/2,e.width-e.lineWidth,e.height-e.lineWidth)}else if(e.strokePosition=="outset"){this.context.closePath();this.context.beginPath();this.context.strokeRect(-e.lineWidth/2,-e.lineWidth/2,e.width+e.lineWidth,e.height+e.lineWidth)}else{this.context.strokeRect(0,0,e.width,e.height)}this.context.stroke()}}this.context.closePath()}else if(i instanceof t.Text){this.context.font=e.fontStyle+" "+parseInt(e.fontSize,10)+"px "+e.fontFamily;this.context.textBaseline=e.textBaseline;if(e.fillStyle){this.context.fillText(e.value,0,0)}if(e.lineWidth){this.context.strokeText(e.value,0,0)}}this.context.restore();return this};this.animate=function(t){if(typeof this.callback=="function"){if(this.ftime){this.dt=t-this.ftime;this.fps=(1e3/this.dt).toFixed(2)/1}this.requestAnimation=requestAnimationFrame(this.animate.bind(this));this.callback.call(this);this.ftime=t}else{this.stop()}return this};this.clear=function(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);return this};this.draw=function(t){this.callback=t;this.start();return this};this.exportBase64=function(t,i){if(!t){t="image/png"}if(typeof i!="number"){i=1}return this.canvas.toDataURL(t,i)};this.start=function(){this.animate();return this};this.stop=function(){this.dt=0;this.fps=0;this.ftime=0;this.requestAnimation=cancelAnimationFrame(this.requestAnimation);return this}};t.prototype.setAnchorPoint=function(i,e){var s=0,o=0;if(i instanceof t.Circle){e.width=e.height=e.radius*2}else if(i instanceof t.Line){e.width=Math.abs(e.endX-e.startX);e.height=Math.abs(e.endY-e.startY)}else if(i instanceof t.Text){this.context.font=parseInt(e.fontSize,10)+"px "+e.fontFamily;e.height=parseInt(e.fontSize,10);e.width=this.context.measureText(e.value).width}i.metrics.width=e.width*e.scale;i.metrics.height=e.height*e.scale;if(typeof e.lineWidth!="undefined"){if(e.strokePosition=="default"){i.metrics.width+=e.lineWidth;i.metrics.height+=e.lineWidth}else if(e.strokePosition=="outset"){i.metrics.width+=e.lineWidth*2;i.metrics.height+=e.lineWidth*2}}if(e.anchor.match(/^top/)){if(typeof e.radius!="undefined"){o=e.radius}if(typeof e.lineWidth!="undefined"){if(e.strokePosition=="default"){o+=e.lineWidth/2}else if(e.strokePosition=="outset"){o+=e.lineWidth}}}else if(e.anchor.match(/^bottom/)){if(typeof e.radius!="undefined"){o=-e.radius}else{o=-e.height}if(typeof e.lineWidth!="undefined"){if(e.strokePosition=="default"){o-=e.lineWidth/2}else if(e.strokePosition=="outset"){o-=e.lineWidth}}}else if(e.anchor.match(/^center/)){if(typeof e.radius=="undefined"){o=-(e.height/2)}}if(e.anchor.match(/left$/)){if(typeof e.radius!="undefined"){s=e.radius}if(typeof e.lineWidth!="undefined"){if(e.strokePosition=="default"){s+=e.lineWidth/2}else if(e.strokePosition=="outset"){s+=e.lineWidth}}}else if(e.anchor.match(/right$/)){if(typeof e.radius!="undefined"){s=-e.radius}else{s=-e.width}if(typeof e.lineWidth!="undefined"){if(e.strokePosition=="default"){s-=e.lineWidth/2}else if(e.strokePosition=="outset"){s-=e.lineWidth}}}else if(e.anchor.match(/center$/)){if(typeof e.radius=="undefined"){s=-(e.width/2)}}s*=e.scale;o*=e.scale;s+=e.x;o+=e.y;if(i instanceof t.Circle){i.metrics.x=s-i.metrics.width/2;i.metrics.y=o-i.metrics.width/2}else{i.metrics.x=s;i.metrics.y=o}this.context.translate(s,o)};t.prototype.setRotate=function(t,i){var e=0,s=0;if(i.anchor.match(/^bottom/)){s=t.metrics.height}else if(i.anchor.match(/^center/)){s=t.metrics.height/2}if(i.anchor.match(/right$/)){e=t.metrics.width}else if(i.anchor.match(/center$/)){e=t.metrics.width/2}if(i.rotate){this.context.translate(e,s);this.context.rotate(i.rotate*Math.PI/180);this.context.translate(-e,-s)}};t.prototype.setOptions=function(t,i){if(!i){return t}var e={};for(var s in t){if(i.hasOwnProperty(s)){e[s]=i[s]}else{e[s]=t[s]}}return e};t.Circle=function(i){this.options=t.prototype.setOptions({x:0,y:0,radius:10,start:0,end:360,counterclockwise:false,fillStyle:"#000",strokeStyle:"#000",strokePosition:"default",lineWidth:0,shadowBlur:0,shadowColor:"#000",shadowOffsetX:0,shadowOffsetY:0,anchor:"top/left",opacity:100,rotate:0,scale:1},i);this.metrics={x:null,y:null,width:null,height:null};this.setOptions=function(i){this.options=t.prototype.setOptions(this.options,i);return this}};t.Image=function(i,e){this.options=t.prototype.setOptions({x:0,y:0,width:null,height:null,offsetX:0,offsetY:0,tileX:1,tileY:1,frames:[],speed:120,loop:true,shadowBlur:0,shadowColor:"#000",shadowOffsetX:0,shadowOffsetY:0,anchor:"top/left",opacity:100,rotate:0,scale:1},e);this.frame=0;this.ftime=null;this.isLoaded=false;this.size={width:null,height:null};this.metrics={x:null,y:null,width:null,height:null};this.loaded=function(){this.isLoaded=true;this.size={width:this.elem.width,height:this.elem.height};if(!this.options.width||this.options.width+this.options.offsetX>this.size.width){this.options.width=this.size.width-this.options.offsetX}if(!this.options.height||this.options.height+this.options.offsetY>this.size.height){this.options.height=this.size.height-this.options.offsetY}};this.setOptions=function(i){this.options=t.prototype.setOptions(this.options,i);return this};if(i&&typeof i=="object"&&i.nodeType==1){this.elem=i;if(this.elem.complete){this.loaded.call(this)}else{this.elem.addEventListener("load",this.loaded.bind(this))}}else{this.elem=document.createElement("img");this.elem.setAttribute("src",i);this.elem.addEventListener("load",this.loaded.bind(this))}};t.Line=function(i){this.options=t.prototype.setOptions({x:0,y:0,startX:0,startY:0,endX:0,endY:0,strokeStyle:"#000",lineWidth:0,lineCap:null,shadowBlur:0,shadowColor:"#000",shadowOffsetX:0,shadowOffsetY:0,anchor:"top/left",opacity:100,rotate:0,scale:1},i);this.metrics={x:null,y:null,width:null,height:null};this.setOptions=function(i){this.options=t.prototype.setOptions(this.options,i);return this}};t.Rect=function(i){this.options=t.prototype.setOptions({x:0,y:0,width:100,height:100,fillStyle:"#000",strokeStyle:"#000",strokePosition:"default",lineWidth:0,borderRadius:0,shadowBlur:0,shadowColor:"#000",shadowOffsetX:0,shadowOffsetY:0,anchor:"top/left",opacity:100,rotate:0,scale:1},i);this.metrics={x:null,y:null,width:null,height:null};this.setOptions=function(i){this.options=t.prototype.setOptions(this.options,i);return this}};t.Text=function(i){this.options=t.prototype.setOptions({x:0,y:0,value:"",fontFamily:"Arial",fontSize:30,fontStyle:"normal",textBaseline:"top",fillStyle:"#000",strokeStyle:"#000",lineWidth:0,shadowBlur:0,shadowColor:"#000",shadowOffsetX:0,shadowOffsetY:0,anchor:"top/left",opacity:100,rotate:0,scale:1},i);this.metrics={x:null,y:null,width:null,height:null};this.setOptions=function(i){this.options=t.prototype.setOptions(this.options,i);return this}};window.Facade=t}();